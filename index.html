<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>JSON Data Viewer</title>
    <link rel="icon" type="image/png" href="icons/pencils.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>JSON Data Viewer</h1>
    <textarea id="jsonInput" placeholder="Paste your JSON array here..."></textarea>

    <div class="actions">
        <button onclick="clearBox()">Clear</button>
    </div>

    <div class="container">
        <div class="block">
            <h2>Text</h2>
            <div id="textBlock" class="content" onclick="copyBlock('textBlock')"></div>
            <button class="copy" onclick="copyBlock('textBlock')">Copy</button>
            <div class="tooltip" id="textTooltip">Copied!</div>
        </div>

        <div class="block">
            <h2>Correct</h2>
            <div id="correctBlock" class="content" onclick="copyBlock('correctBlock')"></div>
            <button class="copy" onclick="copyBlock('correctBlock')">Copy</button>
            <div class="tooltip" id="correctTooltip">Copied!</div>
        </div>

        <div class="block">
            <h2>Result</h2>
            <div id="resultBlock" class="content" onclick="copyBlock('resultBlock')"></div>
            <button class="copy" onclick="copyBlock('resultBlock')">Copy</button>
            <div class="tooltip" id="resultTooltip">Copied!</div>
        </div>
    </div>

    <div id="itemViewer" class="item-viewer">
        <button class="nav-btn" onclick="prevItem()">&#8592;</button>
        <div id="itemContentContainer" class="item-content-container"><pre id="itemContent" class="item-content"></pre></div>
        <button class="nav-btn" onclick="nextItem()">&#8594;</button>
        <div id="itemNumbers" class="item-numbers"></div>
    </div>


    <script>
        const inputBox = document.getElementById('jsonInput');
        // Global variables to store JSON data and current item index
        let jsonData = [];
        let currentItemIndex = 0;

        function processJson() {
            let input = inputBox.value.trim();
            let data;
            try {
                // Remove trailing comma if present
                if (input.endsWith(',')) input = input.slice(0, -1);
                // Allow users to paste raw object lists without surrounding []
                const normalized = input.startsWith('[') ? input : `[${input}]`;
                jsonData = JSON.parse(normalized);
            } catch (err) {
                alert('Invalid JSON');
                return;
            }

            const textLines = [];
            const correctLines = [];
            const resultLines = [];

            for (const item of jsonData) {
                if (item.Text) textLines.push(item.Text);
                if (item.Correct) correctLines.push(item.Correct);
                if (item.Result) resultLines.push(item.Result);
            }

            document.getElementById('textBlock').textContent = textLines.join('\n');
            document.getElementById('correctBlock').textContent = correctLines.join('\n');
            document.getElementById('resultBlock').textContent = resultLines.join('\n');

            // Show the item viewer if we have data
            if (jsonData.length > 0) {
                document.getElementById('itemViewer').classList.add('active');
                currentItemIndex = 0;
                updateItemViewer();
                generateNumberButtons();
            } else {
                document.getElementById('itemViewer').classList.remove('active');
            }
        }
        function updateItemViewer() {
            const item = jsonData[currentItemIndex];
            document.getElementById('itemContent').textContent = JSON.stringify(item, null, 2);

            document.querySelectorAll('#itemNumbers button').forEach((btn, i) => {
                btn.classList.toggle('active', i === currentItemIndex);
            });
        }

        function prevItem() {
            if (currentItemIndex > 0) {
                currentItemIndex--;
                updateItemViewer();
            }
        }

        function nextItem() {
            if (currentItemIndex < jsonData.length - 1) {
                currentItemIndex++;
                updateItemViewer();
            }
        }

        function generateNumberButtons() {
            const container = document.getElementById('itemNumbers');
            container.innerHTML = '';

            jsonData.forEach((_, i) => {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.onclick = () => {
                    currentItemIndex = i;
                    updateItemViewer();
                };
                container.appendChild(btn);
            });
        }

        
        function clearBox() {
            inputBox.value = "";
        }

        function copyBlock(id) {
            const text = document.getElementById(id).textContent;
            let copyText = `========== ${id.replace('Block', '').toUpperCase()} ==========\n` + text;
            navigator.clipboard.writeText(copyText).then(() => {
                // Show tooltip for the specific block
                const tooltipId = id.replace('Block', 'Tooltip');
                const tooltip = document.getElementById(tooltipId);
                
                // Show tooltip
                tooltip.classList.add('show');
                
                // Hide tooltip after 2 seconds
                setTimeout(() => {
                    tooltip.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }
        
        // Run processJson on input in the textarea
        inputBox.addEventListener('input', processJson);
    </script>

</body>

</html>