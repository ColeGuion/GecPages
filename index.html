<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>JSON Data Viewer</title>
    <link rel="icon" type="image/png" href="icons/pencils.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>JSON Data Viewer</h1>

    <textarea id="jsonInput" placeholder="Paste your JSON array here..."></textarea>

    <!-- <div class="actions"><button onclick="processJson()">Process JSON</button></div> -->
    <div class="actions">
        <button onclick="clearBox()">Clear</button>
    </div>

    <div class="container">
        <div class="block">
            <h2>Text</h2>
            <div id="textBlock" class="content" onclick="copyBlock('textBlock')"></div>
            <button class="copy" onclick="copyBlock('textBlock')">Copy</button>
            <div class="tooltip" id="textTooltip">Copied!</div>
        </div>

        <div class="block">
            <h2>Correct</h2>
            <div id="correctBlock" class="content" onclick="copyBlock('correctBlock')"></div>
            <button class="copy" onclick="copyBlock('correctBlock')">Copy</button>
            <div class="tooltip" id="correctTooltip">Copied!</div>
        </div>

        <div class="block">
            <h2>Result</h2>
            <div id="resultBlock" class="content" onclick="copyBlock('resultBlock')"></div>
            <button class="copy" onclick="copyBlock('resultBlock')">Copy</button>
            <div class="tooltip" id="resultTooltip">Copied!</div>
        </div>
    </div>

    <script>
        const inputBox = document.getElementById('jsonInput');
        function clearBox() {

        }
        function processJson() {
            let input = inputBox.value.trim();

            let data;
            try {
                // Remove trailing comma if present before closing ]
                if (input.endsWith(',')) {
                    input = input.slice(0, -1);
                }
                // Allow users to paste raw object lists without surrounding []
                const normalized = input.startsWith('[') ? input : `[${input}]`;
                data = JSON.parse(normalized);
            } catch (err) {
                alert('Invalid JSON');
                return;
            }

            const textLines = [];
            const correctLines = [];
            const resultLines = [];

            for (const item of data) {
                if (item.Text) textLines.push(item.Text);
                if (item.Correct) correctLines.push(item.Correct);
                if (item.Result) resultLines.push(item.Result);
            }

            document.getElementById('textBlock').textContent = textLines.join('\n');
            document.getElementById('correctBlock').textContent = correctLines.join('\n');
            document.getElementById('resultBlock').textContent = resultLines.join('\n');
        }

        function copyBlock(id) {
            console.log(`Copied: "${id}"`);
            //let p = id.replace('Block', '');
            //p = p.charAt(0).toUpperCase() + p.slice(1);
            console.log(`P: "${id.replace('Block', '').toUpperCase()}"`);
            const text = document.getElementById(id).textContent;
            let copyText = `========== ${id.replace('Block', '').toUpperCase()} ==========\n` + text;
            navigator.clipboard.writeText(copyText).then(() => {
                // Show tooltip for the specific block
                const tooltipId = id.replace('Block', 'Tooltip');
                const tooltip = document.getElementById(tooltipId);
                
                // Show tooltip
                tooltip.classList.add('show');
                
                // Hide tooltip after 2 seconds
                setTimeout(() => {
                    tooltip.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }
        // Run processJson on input in the textarea
        inputBox.addEventListener('input', processJson);
    </script>

</body>

</html>